<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="co.yedam.product.mapper.ProductMapper">
  
  	<select id="selectProduct" resultType="product">
  		SELECT *
  		FROM products
  	</select>
  	
  	<select id="searchProduct" parameterType="searchCon" resultType="product">
	  	SELECT prod_no,
	  	       prod_name,
	  	       prod_brand,
	  	       prod_price,
	  	       prod_type,
	  	       prod_sale,
	  	       prod_from,
	  	       prod_date,
	  	       prod_stock,
	  	       prod_ordcnt,
	  	       prod_img
	  	FROM(	
	  		SELECT /*+ INDEX(p pk_products) */ ROWNUM rn, p.*
	  		FROM (SELECT /*+ INDEX(p pk_products) */ c.*
              	  FROM products c
              	  WHERE ${listtype}
              	  ORDER BY ${sort}) p
	  		WHERE prod_no = prod_no
	  		<if test="brand != null and !brand.equals('')">
	    		AND prod_brand IN (
				<foreach collection="brand" item="bname" index="i" separator=",">
					#{bname}
				</foreach>
				)
	  		</if>
	  		<if test="type != null and !type.equals('')">
	    		AND prod_type IN (
				<foreach collection="type" item="btype" index="i" separator=",">
					#{btype}
				</foreach>
				)
	  		</if>
	  		<if test="price != null and price != 0">
	    		AND prod_price-(ROUND(prod_price*prod_sale/100)*100) <![CDATA[<=]]> ${price}
	  		</if>
	  		<if test="keyword != null and !keyword.equals('')">
	    		AND prod_name like #{keyword}
	  		</if>
        	AND ROWNUM <![CDATA[<=]]> (#{ppage} * 6) 
        	) b
  		WHERE b.rn > (#{ppage} - 1) * 6
  	</select>
  	
  	<select id="selectCount" parameterType="searchCon" resultType="int">
		SELECT COUNT(*)
		FROM   products
		WHERE ${listtype}
	  		<if test="brand != null and !brand.equals('')">
	    		AND prod_brand IN (
				<foreach collection="brand" item="bname" index="i" separator=",">
					#{bname}
				</foreach>
				)
	  		</if>
	  		<if test="type != null and !type.equals('')">
	    		AND prod_type IN (
				<foreach collection="type" item="btype" index="i" separator=",">
					#{btype}
				</foreach>
				)
	  		</if>
	  		<if test="price != null and price != 0">
	    		AND prod_price-(ROUND(prod_price*prod_sale/100)*100) <![CDATA[<=]]> ${price}
	  		</if>
	  		<if test="keyword != null and !keyword.equals('')">
	    		AND prod_name like #{keyword}
	  		</if>
	</select>
  	
  </mapper>